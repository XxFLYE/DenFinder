package APIs;

import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;
import org.json.*;

import java.net.URL;
import java.net.URLConnection;

public class Census {
	
	public static void main(String[] args) throws IOException, JSONException{
		
		String state = "VA";
		censusDataCityLvl(state);
		
	}
	
	
	
	public static void censusDataStLvl() throws IOException, JSONException{
		
		
		String censusURLPop = new String("http://api.usatoday.com/open/census/pop?keypat=Louisiana&keyname=placename&api_key=ess47cw42vehm8jjztp8qjwp");
		String censusURLHos = new String("http://api.usatoday.com/open/census/hou?api_key=ess47cw42vehm8jjztp8qjwp");
		//String educationURL = new String("http://api.education.com/service/service.php?f=getReviews&key=0eb991b50ebfafa405a4a97f750e0175&sn=sf&v=4&Reqf");
	
		JSONObject censusJSONPop = new JSONObject(censusContent(censusURLPop));
		String placename = censusJSONPop.getJSONArray("response").getJSONObject(0).getString("Placename");
		String population = censusJSONPop.getJSONArray("response").getJSONObject(0).getString("Pop");

		
		JSONObject censusJSONHos = new JSONObject(censusContent(censusURLHos));
		String housing = censusJSONHos.getJSONArray("response").getJSONObject(0).getString("HousingUnits");
		String vacant = censusJSONHos.getJSONArray("response").getJSONObject(0).getString("PctVacant");
		
		float pctvacant = Float.parseFloat(vacant);
		int vacantPercent = (int) (pctvacant * 100);
		
		System.out.print("State: " + placename+ "\n");
		System.out.print("Population: "+ population + "\n");
		System.out.print("Housing Units: " + housing + "\n");
		System.out.print("Percent Vacant: " + vacantPercent + "% \n");
		
	}
public static void censusDataCityLvl(String state) throws IOException, JSONException{
		
		
		String censusURLPop = new String("http://api.usatoday.com/open/census/pop?keypat=" +state+"&sumlevid=4,6&api_key=ess47cw42vehm8jjztp8qjwp");
		String censusURLHos = new String("http://api.usatoday.com/open/census/hou?keypat=VA&sumlevid=4,6&api_key=ess47cw42vehm8jjztp8qjwp");
	
		JSONObject censusJSONPop = new JSONObject(censusContent(censusURLPop));
		JSONObject censusJSONHos = new JSONObject(censusContent(censusURLHos));
		
		for(int i = 0; i < censusJSONHos.getJSONArray("response").length(); i++){
			String placename = censusJSONPop.getJSONArray("response").getJSONObject(i).getString("Placename");
			String population = censusJSONPop.getJSONArray("response").getJSONObject(i).getString("Pop");
			String housing = censusJSONHos.getJSONArray("response").getJSONObject(i).getString("HousingUnits");
			String vacant = censusJSONHos.getJSONArray("response").getJSONObject(i).getString("PctVacant");
			
			float pctvacant = Float.parseFloat(vacant);
			int vacantPercent = (int) (pctvacant * 100);
			
			System.out.print("State: " + state +"\n");
			System.out.print("City: " + placename+ "\n");
			System.out.print("Population: "+ population + "\n");
			System.out.print("Housing Units: " + housing + "\n");
			System.out.print("Percent Vacant: " + vacantPercent + "% \n");
			System.out.println();
		}
		
	}

	private static String censusContent(String url) throws IOException {
		
		StringBuilder content = new StringBuilder();
	    try
	    {
	    	
	      URL censusURL = new URL(url);
	      URLConnection urlConnection = censusURL.openConnection();
	      BufferedReader bufferedReader = new BufferedReader(new InputStreamReader(urlConnection.getInputStream()));
	      String line;
	 
	      while ((line = bufferedReader.readLine()) != null){
	    	  
	        content.append(line + "\n");
	      }
	      bufferedReader.close();
	      
	    }
	    catch(Exception e)
	    {
	      e.printStackTrace();
	    }
	    return content.toString();
	 }
}
